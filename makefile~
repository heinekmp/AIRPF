IDIR = ./include
CC=mpicc
CFLAGS=-I$(IDIR) 
 
LIBS= -lm -lgsl -lgslcblas
ODIR = obj

_DEPS = fileio.h likelihood.h resampling.h typedefs.h mutation.h radix.h master_tasks.h randomisation.h ipf_balance.h
DEPS = $(patsubst %,$(IDIR)/%,$(_DEPS))

_OBJ =  fileio.o likelihood.o resampling.o typedefs.o mutation.o radix.o master_tasks.o randomisation.o ipf_balance.o
OBJ = $(patsubst %,$(ODIR)/%,$(_OBJ))

# All object files depend on the corresponding c-file and the DEPS
$(ODIR)/%.o: ./src/%.c $(DEPS)
	$(CC) -std=c99 -Wall -c -o $@ $< $(CFLAGS) $(LIBS)

# All the o-files need to be up-to-date
ipf0: ./obj/ipf0.o $(OBJ) 
	$(CC) -std=c99 -Wall -o $@ $^ $(CFLAGS) $(LIBS) 

# All the o-files need to be up-to-date
ippf: ./obj/ippf3.o $(OBJ)
	$(CC) -std=c99 -Wall -o $@ $^ $(CFLAGS) $(LIBS)

ipf: ./obj/ipf.o $(OBJ)
	$(CC) -std=c99 -Wall -o $@ $^ $(CFLAGS) $(LIBS)

ipff: ./obj/ippf_flex.o $(OBJ)
	$(CC) -std=c99 -Wall -o $@ $^ $(CFLAGS) $(LIBS)
